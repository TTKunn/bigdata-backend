# [001] 大数据商城后端环境联调测试方案

## 文档信息

| 文档编号 | [001] |
|----------|-------|
| 文档名称 | 大数据商城后端环境联调测试方案 |
| 版本号 | 1.0 |
| 创建日期 | 2026-01-06 |
| 作者 | 测试工程师 |
| 关联文档 | [000]需求分析文档 |
| 测试类型 | 环境联调测试 |

## 目录

1. [测试概述](#测试概述)
2. [测试目标](#测试目标)
3. [测试环境](#测试环境)
4. [测试范围](#测试范围)
5. [测试准备](#测试准备)
6. [测试用例设计](#测试用例设计)
7. [测试执行步骤](#测试执行步骤)
8. [预期结果](#预期结果)
9. [验证方法](#验证方法)
10. [清理方案](#清理方案)
11. [风险评估](#风险评估)

## 测试概述

### 测试背景

为确保大数据商城后端项目能够正常连接和操作Hadoop/HBase集群环境，需要进行环境联调测试。本次测试主要验证SpringBoot应用与HBase集群的网络连通性、API调用流程、数据写入功能等核心联调能力。

### 测试原则

1. **简单原则**：测试内容简洁明了，专注于环境连通性验证
2. **独立原则**：测试代码独立，不影响后续正式开发
3. **可清理原则**：测试完成后可完全清理，不留痕迹
4. **安全性原则**：不涉及生产数据，不影响现有集群环境

### 测试策略

- **测试方法**：黑盒测试 + 白盒验证
- **测试类型**：功能测试 + 环境测试
- **测试数据**：模拟测试数据，不使用真实业务数据
- **测试工具**：ApiFox + HBase Shell + 浏览器

## 测试目标

### 主要目标

1. **网络连通性验证**
   - SpringBoot应用能够连接HBase集群
   - HBase客户端配置正确
   - Zookeeper连接正常

2. **API接口验证**
   - RESTful API能够正常响应
   - JSON数据接收和处理正常
   - HTTP状态码返回正确

3. **数据写入验证**
   - 能够成功创建HBase表
   - 数据能够成功写入HBase
   - 数据能够通过HBase Shell查询

4. **异常处理验证**
   - 网络异常时的错误处理
   - 数据格式异常时的错误处理
   - HBase连接异常时的错误处理

### 成功标准

- ✅ API接口调用成功（HTTP 200状态码）
- ✅ 数据成功写入HBase表
- ✅ 通过HBase Shell能够查询到写入的数据
- ✅ 应用日志显示操作成功
- ✅ 无异常错误抛出

## 测试环境

### 硬件环境

#### 开发主机（Windows）
- **操作系统**：Windows 10/11
- **CPU**：Intel i5 8核以上
- **内存**：16GB以上
- **磁盘**：SSD 500GB以上
- **网络**：正常网络连接

#### 大数据集群（Linux虚拟机）
- **主节点 (bigdata01)**
  - IP地址：192.168.32.200
  - 操作系统：CentOS 7.x
  - CPU：4核
  - 内存：8GB
  - 磁盘：100GB

- **从节点1 (hadoop-slave01)**
  - IP地址：192.168.32.201
  - 操作系统：CentOS 7.x
  - CPU：4核
  - 内存：8GB
  - 磁盘：100GB

- **从节点2 (hadoop-slave02)**
  - IP地址：192.168.32.202
  - 操作系统：CentOS 7.x
  - CPU：4核
  - 内存：8GB
  - 磁盘：100GB

### 软件环境

#### Java环境
- **JDK版本**：OpenJDK 17.0.x
- **Maven版本**：3.8.x

#### 大数据环境
- **Hadoop版本**：3.3.x
- **HBase版本**：2.4.x
- **Zookeeper版本**：3.7.x

#### 开发工具
- **IDE**：IntelliJ IDEA 2023.x
- **API测试工具**：ApiFox
- **数据库客户端**：HBase Shell

#### 应用环境
- **Spring Boot版本**：2.7.x
- **Spring Web版本**：5.3.x
- **HBase客户端版本**：2.4.x

## 测试范围

### 包含内容

#### 1. 网络连通性测试
- SpringBoot应用到HBase集群的网络连接
- Zookeeper服务发现和连接
- HBase Master和RegionServer连接

#### 2. API接口测试
- RESTful API端点创建和响应
- JSON请求体解析
- HTTP响应格式和状态码

#### 3. 数据操作测试
- HBase表创建
- HBase数据写入（Put操作）
- HBase数据查询（Get操作）

#### 4. 配置验证测试
- HBase连接配置正确性
- Spring Boot配置文件正确性
- 依赖包版本兼容性

### 不包含内容

#### 1. 业务逻辑测试
- 复杂的业务规则验证
- 数据校验逻辑
- 业务异常处理

#### 2. 性能测试
- 高并发测试
- 压力测试
- 性能基准测试

#### 3. Redis相关测试
- Redis连接测试
- Redis数据操作
- 缓存同步机制

#### 4. 完整功能测试
- 用户管理功能
- 订单处理功能
- 购物车功能

## 测试准备

### 环境准备

#### 1. 大数据集群验证
```bash
# 在主节点上执行，检查集群状态
hadoop version
hbase version
zkServer.sh status

# 检查HBase服务状态
hbase shell
status
list
exit
```

#### 2. 网络连通性检查
```bash
# 从Windows主机ping测试
ping 192.168.32.200
ping 192.168.32.201
ping 192.168.32.202

# 测试SSH连接
ssh root@192.168.32.200
ssh root@192.168.32.201
ssh root@192.168.32.202
```

#### 3. 项目环境准备
```bash
# 确保Java版本正确
java -version
# 输出应包含：openjdk version "17.x.x"

# Maven版本检查
mvn -version

# 项目编译测试
mvn clean compile
```

### 测试数据准备

#### 测试数据格式
```json
{
  "id": "test_001",
  "name": "环境联调测试商品",
  "category": "测试分类",
  "price": 99.99,
  "description": "这是一个用于环境联调的测试商品数据",
  "createTime": "2026-01-06T10:00:00Z"
}
```

#### HBase表结构
```
表名: env_test_product
RowKey: test_001

列族: cf_info
- name: 环境联调测试商品
- category: 测试分类
- price: 99.99
- description: 这是一个用于环境联调的测试商品数据
- create_time: 2026-01-06T10:00:00Z
```

## 测试用例设计

### 测试用例TC001: 基础连通性测试

**用例编号**：TC001
**用例名称**：HBase集群基础连通性测试
**测试类型**：环境测试
**优先级**：高

**前置条件**：
- HBase集群已启动
- SpringBoot应用已配置HBase连接

**测试步骤**：
1. 启动SpringBoot应用
2. 查看应用启动日志，确认HBase连接成功
3. 检查应用无异常错误

**预期结果**：
- 应用启动成功，无连接错误
- 日志显示"HBase connection established"
- 应用监听端口正常

### 测试用例TC002: API接口可用性测试

**用例编号**：TC002
**用例名称**：测试API接口创建和响应
**测试类型**：功能测试
**优先级**：高

**前置条件**：
- TC001执行成功
- ApiFox工具已安装

**测试步骤**：
1. 使用ApiFox访问测试接口：`GET /api/test/health`
2. 验证HTTP响应状态码为200
3. 验证响应内容格式正确

**预期结果**：
- HTTP状态码：200 OK
- 响应内容：`{"status":"success","message":"HBase connection is healthy"}`

### 测试用例TC003: 数据写入测试

**用例编号**：TC003
**用例名称**：测试数据写入HBase功能
**测试类型**：功能测试
**优先级**：高

**前置条件**：
- TC001、TC002执行成功

**测试步骤**：
1. 使用ApiFox调用数据写入接口
2. 发送测试JSON数据到`POST /api/test/product`
3. 验证接口返回成功响应
4. 使用HBase Shell查询写入的数据

**预期结果**：
- 接口返回HTTP 200状态码
- 响应内容包含写入成功的确认信息
- HBase Shell能够查询到写入的数据

### 测试用例TC004: 数据查询测试

**用例编号**：TC004
**用例名称**：测试数据查询功能
**测试类型**：功能测试
**优先级**：中

**前置条件**：
- TC003执行成功

**测试步骤**：
1. 使用ApiFox调用数据查询接口：`GET /api/test/product/test_001`
2. 验证返回的数据与写入的数据一致

**预期结果**：
- 接口返回HTTP 200状态码
- 返回的JSON数据与写入数据完全一致

### 测试用例TC005: 异常处理测试

**用例编号**：TC005
**用例名称**：测试异常情况处理
**测试类型**：异常测试
**优先级**：中

**前置条件**：
- TC001、TC002执行成功

**测试步骤**：
1. 临时停止HBase服务
2. 调用数据写入接口
3. 验证异常处理和错误响应
4. 重启HBase服务，验证恢复正常

**预期结果**：
- 异常情况下返回适当的HTTP错误状态码
- 错误响应包含有意义的错误信息
- 服务恢复后功能正常

## 测试执行步骤

### 步骤1: 环境验证（10分钟）

1. **集群状态检查**
   ```bash
   # 在主节点执行
   hbase shell
   status
   version
   list
   exit
   ```

2. **网络连通性测试**
   ```bash
   # 在Windows主机执行
   ping 192.168.32.200
   telnet 192.168.32.200 2181  # Zookeeper端口
   telnet 192.168.32.200 16010 # HBase Master端口
   ```

3. **应用编译测试**
   ```bash
   cd E:\Code\project\bigdata-backend
   mvn clean compile -DskipTests
   ```

### 步骤2: 应用启动测试（5分钟）

1. **启动SpringBoot应用**
   ```bash
   mvn spring-boot:run
   ```

2. **日志观察**
   - 确认无HBase连接错误
   - 确认应用启动成功，端口监听正常

3. **基础健康检查**
   - 使用浏览器访问：`http://localhost:8080/api/test/health`

### 步骤3: API接口测试（10分钟）

1. **ApiFox配置**
   - 创建新的请求集合：`环境联调测试`
   - 配置基础URL：`http://localhost:8080`

2. **健康检查接口测试**
   ```
   Method: GET
   URL: /api/test/health
   Headers: Content-Type: application/json
   ```

3. **数据写入接口测试**
   ```
   Method: POST
   URL: /api/test/product
   Headers: Content-Type: application/json
   Body:
   {
     "id": "test_001",
     "name": "环境联调测试商品",
     "category": "测试分类",
     "price": 99.99,
     "description": "这是一个用于环境联调的测试商品数据",
     "createTime": "2026-01-06T10:00:00Z"
   }
   ```

4. **数据查询接口测试**
   ```
   Method: GET
   URL: /api/test/product/test_001
   Headers: Content-Type: application/json
   ```

### 步骤4: HBase数据验证（5分钟）

1. **连接HBase Shell**
   ```bash
   # 在主节点执行
   hbase shell
   ```

2. **查看表结构**
   ```bash
   list
   describe 'env_test_product'
   ```

3. **查询测试数据**
   ```bash
   get 'env_test_product', 'test_001'
   scan 'env_test_product'
   ```

4. **验证数据完整性**
   - 确认所有字段都已正确写入
   - 确认数据类型和格式正确

### 步骤5: 异常测试（5分钟）

1. **停止HBase服务**
   ```bash
   # 在主节点执行
   hbase-daemon.sh stop master
   hbase-daemons.sh stop regionserver
   ```

2. **测试异常处理**
   - 调用写入接口，确认返回错误
   - 查看应用日志，确认异常处理正确

3. **恢复服务**
   ```bash
   # 在主节点执行
   hbase-daemon.sh start master
   hbase-daemons.sh start regionserver
   ```

4. **验证恢复**
   - 等待服务完全启动
   - 重新执行写入测试，确认功能恢复

## 预期结果

### 成功场景结果

#### 1. 应用启动成功
```
2026-01-06 10:00:00.000  INFO 12345 --- [main] c.e.b.BigdataBackendApplication : Started BigdataBackendApplication in 5.123 seconds
2026-01-06 10:00:00.100  INFO 12345 --- [main] c.e.b.config.HBaseConfig : HBase connection established successfully
2026-01-06 10:00:00.200  INFO 12345 --- [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http)
```

#### 2. API接口响应成功
```json
// GET /api/test/health
{
  "status": "success",
  "message": "HBase connection is healthy",
  "timestamp": "2026-01-06T10:00:00Z"
}

// POST /api/test/product
{
  "status": "success",
  "message": "Product data written to HBase successfully",
  "rowKey": "test_001",
  "timestamp": "2026-01-06T10:00:01Z"
}

// GET /api/test/product/test_001
{
  "id": "test_001",
  "name": "环境联调测试商品",
  "category": "测试分类",
  "price": 99.99,
  "description": "这是一个用于环境联调的测试商品数据",
  "createTime": "2026-01-06T10:00:00Z"
}
```

#### 3. HBase数据查询结果
```bash
hbase(main):001:0> get 'env_test_product', 'test_001'
COLUMN                                    CELL
 cf_info:category                         timestamp=2026-01-06T10:00:01Z, value=测试分类
 cf_info:create_time                      timestamp=2026-01-06T10:00:01Z, value=2026-01-06T10:00:00Z
 cf_info:description                      timestamp=2026-01-06T10:00:01Z, value=这是一个用于环境联调的测试商品数据
 cf_info:name                             timestamp=2026-01-06T10:00:01Z, value=环境联调测试商品
 cf_info:price                            timestamp=2026-01-06T10:00:01Z, value=99.99
1 row(s)
Took 0.0150 seconds
```

### 异常场景结果

#### 网络连接异常
```json
{
  "status": "error",
  "message": "Failed to connect to HBase cluster",
  "error": "org.apache.hadoop.hbase.ZooKeeperConnectionException: Unable to connect to zookeeper",
  "timestamp": "2026-01-06T10:00:00Z"
}
```

#### 数据格式异常
```json
{
  "status": "error",
  "message": "Invalid request data format",
  "error": "Missing required field: id",
  "timestamp": "2026-01-06T10:00:00Z"
}
```

## 验证方法

### 自动化验证

#### 1. 脚本验证
```bash
#!/bin/bash
# 自动化验证脚本

# 1. 检查应用健康状态
curl -s http://localhost:8080/api/test/health | jq '.status' | grep -q "success"

# 2. 执行数据写入测试
curl -X POST http://localhost:8080/api/test/product \
  -H "Content-Type: application/json" \
  -d '{"id":"test_001","name":"测试商品","category":"测试","price":99.99}' \
  | jq '.status' | grep -q "success"

# 3. 验证数据写入
curl -s http://localhost:8080/api/test/product/test_001 | jq '.id' | grep -q "test_001"
```

#### 2. 日志验证
```bash
# 检查应用日志
tail -f logs/spring.log | grep -E "(HBase connection|Product data written|Query executed)"

# 检查HBase日志
tail -f /usr/local/hbase/logs/hbase-root-master-bigdata01.log | grep -E "(Put operation|Get operation)"
```

### 手动验证

#### 1. ApiFox测试验证
- 创建测试用例集合
- 配置环境变量
- 执行批量测试
- 生成测试报告

#### 2. HBase Shell验证
```bash
# 手动执行HBase命令验证
hbase shell
list
describe 'env_test_product'
get 'env_test_product', 'test_001'
count 'env_test_product'
```

#### 3. 集群状态验证
```bash
# 验证集群健康状态
hadoop dfsadmin -report
hbase hbck
jps  # 查看Java进程
```

## 清理方案

### 测试完成后清理步骤

#### 1. 停止应用
```bash
# 停止SpringBoot应用
Ctrl+C 或 kill -TERM <pid>
```

#### 2. 删除测试数据
```bash
# HBase Shell中执行
hbase shell
disable 'env_test_product'
drop 'env_test_product'
list
exit
```

#### 3. 删除测试代码
```bash
# 删除测试相关的Java文件
rm src/main/java/com/example/bigdatabackend/controller/TestController.java
rm src/main/java/com/example/bigdatabackend/service/TestService.java
rm src/main/java/com/example/bigdatabackend/config/TestHBaseConfig.java

# 删除测试相关的配置文件修改
git checkout -- src/main/resources/application.properties
```

#### 4. 清理日志
```bash
# 清理应用日志
rm -rf logs/

# 清理HBase测试日志（可选）
# 注意：生产环境不要清理HBase日志
```

#### 5. Maven清理
```bash
# 清理Maven缓存
mvn clean

# 清理target目录
rm -rf target/
```

### 清理验证

#### 验证清理完成
```bash
# 1. 检查应用是否停止
ps aux | grep java | grep bigdata-backend

# 2. 检查HBase表是否删除
hbase shell -e "list" | grep env_test_product

# 3. 检查端口是否释放
netstat -tlnp | grep :8080

# 4. 检查测试文件是否删除
find . -name "*Test*" -type f
```

## 风险评估

### 技术风险

#### 1. 网络连接风险
- **风险等级**：中
- **风险描述**：虚拟机网络配置可能导致连接失败
- **应对措施**：
  - 提前验证网络配置
  - 准备网络诊断工具
  - 联系网络管理员支持

#### 2. 版本兼容性风险
- **风险等级**：低
- **风险描述**：JDK17与HBase版本可能存在兼容性问题
- **应对措施**：
  - 使用指定的JDK17版本
  - 验证HBase客户端版本兼容性
  - 准备版本降级方案

#### 3. 集群状态风险
- **风险等级**：中
- **风险描述**：HBase集群可能未正常启动或配置错误
- **应对措施**：
  - 提前检查集群状态
  - 准备集群重启脚本
  - 联系集群管理员

### 业务风险

#### 1. 测试数据污染
- **风险等级**：低
- **风险描述**：测试数据可能影响其他测试或生产数据
- **应对措施**：
  - 使用独立测试表
  - 测试完成后立即清理
  - 明确标识测试数据

#### 2. 资源占用风险
- **风险等级**：低
- **风险描述**：测试过程可能占用过多系统资源
- **应对措施**：
  - 限制测试数据量
  - 监控资源使用情况
  - 测试完成后释放资源

### 操作风险

#### 1. 操作失误风险
- **风险等级**：中
- **风险描述**：误操作导致集群服务中断或数据丢失
- **应对措施**：
  - 详细记录操作步骤
  - 双人确认重要操作
  - 准备数据备份

#### 2. 时间评估风险
- **风险等级**：低
- **风险描述**：实际测试时间可能超出预期
- **应对措施**：
  - 预留充足测试时间
  - 分阶段执行测试
  - 准备应急方案

---

**文档状态**：草稿
**审核状态**：待审核
**版本控制**：
- v1.0 (2026-01-06)：初始版本，完成环境联调测试方案
- 预计更新：根据审核意见完善方案
